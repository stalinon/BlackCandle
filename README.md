## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–æ–ª–∏—Ç–∞ (Solution structure, –Ω–æ –ø–æ-—É–º–Ω–æ–º—É)

–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –≤ .NET ‚Äî —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç "–æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ –≤—Å–µ —Å–ª—É—á–∞–∏". –≠—Ç–æ –∑–Ω–∞—á–∏—Ç "–≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ä–µ—à–µ–Ω–∏–∏, –Ω–æ —Å –≥–æ–ª–æ–≤–æ–π". –í–æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
/BlackCandle.sln
  |-- BlackCandle.API             // ASP.NET Core Web API
  |-- BlackCandle.Application     // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Å–µ—Ä–≤–∏—Å—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
  |-- BlackCandle.Infrastructure  // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: API, –±–∞–∑—ã, –ª–æ–≥–∏
  |-- BlackCandle.Domain          // –ú–æ–¥–µ–ª–∏, –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, enums
  |-- BlackCandle.Telegram        // –†–∞–±–æ—Ç–∞ —Å Telegram-–±–æ—Ç–æ–º
  |-- BlackCandle.Scheduler       // –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Hangfire/Quartz)
  |-- BlackCandle.Tests           // xUnit + Moq
```

---

–û–∫–µ–π, –ø–æ-—Å–µ—Ä—å—ë–∑–∫–µ. –°–µ–π—á–∞—Å –Ω–µ –≤—Ä–µ–º—è –ø–∏—Ö–∞—Ç—å –∫–æ–¥, —Å–µ–π—á–∞—Å –≤—Ä–µ–º—è **—Å—Ç—Ä–æ–∏—Ç—å –±–µ—Ç–æ–Ω–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç**, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –Ω–µ –±–µ–≥–∞—Ç—å —Å –∫—Ä–∏–∫–∞–º–∏ "–∞ –∫—É–¥–∞ –≤–æ—Ç —ç—Ç–æ –ø–æ–ª–æ–∂–∏—Ç—å?".

–†–∞–∑–±–µ—Ä—ë–º **–ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–µ–∫—Ç—É**, —á—Ç–æ —Ç–∞–º –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, **–∫–∞–∫–∏–µ –∫–ª–∞—Å—Å—ã**, **—á—Ç–æ –æ–Ω–∏ –¥–µ–ª–∞—é—Ç**, –∏ **–∑–∞—á–µ–º –≤–æ–æ–±—â–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç**. –í—Å—ë –ø–æ —É–º—É, –±–µ–∑ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏, —Å—Ç—Ä–æ–≥–æ –∏ –ø–æ –¥–µ–ª—É.

---

## üìÅ `BlackCandle.API` ‚Äî ASP.NET Core Web API

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: —Å–ª–æ–π –æ–±—â–µ–Ω–∏—è —Å –≤–Ω–µ—à–Ω–∏–º –º–∏—Ä–æ–º ‚Äî —Ñ—Ä–æ–Ω—Ç–æ–º, Postman‚Äô–æ–º, —á–µ–º —É–≥–æ–¥–Ω–æ. –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ DTO.

### –°–æ–¥–µ—Ä–∂–∏—Ç:
- **Controllers/**
  - `PortfolioController` ‚Äì —Ä–∞–±–æ—Ç–∞ —Å –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º (–¥–æ–±–∞–≤–∏—Ç—å —Ç–∏–∫–µ—Ä, –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫).
  - `AnalysisController` ‚Äì –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –≤—Ä—É—á–Ω—É—é, –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
  - `SchedulerController` ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–æ–Ω–æ–º (–≤–∫–ª/–≤—ã–∫–ª, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ).
  - `LogsController` ‚Äì –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏.
- **DTO/**
  - `AddTickerRequest`, `PortfolioViewModel`, `AnalysisResultResponse` ‚Äì —Ç–æ, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ —É—Ö–æ–¥–∏—Ç.
- **Middleware/**
  - `ErrorHandlingMiddleware` ‚Äì –≥–ª–æ–±–∞–ª—å–Ω—ã–π try-catch.
- **Configuration/**
  - `DependencyInjectionConfig`, `AppSettings`, `SwaggerSetup`.

---

## üìÅ `BlackCandle.Application` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –º–æ–∑–≥ –ø—Ä–æ–µ–∫—Ç–∞. –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏, orchestrates –≤—Å—ë –≤–µ—Å–µ–ª—å–µ.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **Services/**
  - `IAnalysisService` / `AnalysisService` ‚Äì —Ä–∞—Å—á—ë—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤.
  - `IPortfolioService` / `PortfolioService` ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º (CRUD, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤).
  - `ISignalService` / `SignalService` ‚Äì –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞.
  - `ILoggerService` ‚Äì —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä.
  - `ITelegramService` ‚Äì –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- **UseCases/**
  - `RunPortfolioAnalysisUseCase` ‚Äì –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å—ë: —Ç—è–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ, —Å—á–∏—Ç–∞–µ—Ç, —à–ª—ë—Ç.
  - `UpdatePortfolioUseCase`, `GetPortfolioUseCase`.
- **Interfaces/**
  - –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: `ITinkoffClient`, `IMoexClient`, `IDataStorage`, `ISchedulerAdapter`.
- **Mappers/**
  - `IndicatorMapper`, `SignalMapper` ‚Äì –ø–µ—Ä–µ–≤–æ–¥ –¥–æ–º–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ –æ—Ç–≤–µ—Ç–Ω—ã–µ DTO.

---

## üìÅ `BlackCandle.Infrastructure` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –≥—Ä—è–∑–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API, –±–∞–∑–∞, –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **APIClients/**
  - `TinkoffClient` ‚Äì –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ—Ç–∏—Ä–æ–≤–æ–∫.
  - `MoexClient` ‚Äì –ø–∞—Ä—Å–∏–Ω–≥ MOEX XML/JSON.
- **Indicators/**
  - `SkenderWrapper` ‚Äì –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ Skender.Stock.Indicators, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.
- **Persistence/**
  - `SupabaseStorage` ‚Äì —Ä–∞–±–æ—Ç–∞ —Å –ë–î (—á–µ—Ä–µ–∑ EF –∏–ª–∏ REST, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
  - `EntityMapper`, `DbContext` (–µ—Å–ª–∏ EF).
- **Logging/**
  - `LogtailLogger`, `FileLogger`, `ConsoleLogger` ‚Äì –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ª–æ–≥–≥–µ—Ä—ã.
- **Adapters/**
  - `SchedulerAdapter` ‚Äì —Å–≤—è–∑–∫–∞ —Å Hangfire/Quartz (—á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ISchedulerAdapter`).

---

## üìÅ `BlackCandle.Domain` ‚Äî –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: —è–¥—Ä–æ. –ó–¥–µ—Å—å –≤—Å—ë, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç—è–º.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **Entities/**
  - `Ticker`, `PortfolioAsset`, `TradeSignal`, `IndicatorResult`, `PortfolioAnalysisResult`.
- **Enums/**
  - `TradeAction`, `IndicatorType`, `ExchangeType`, `SignalReason`.
- **ValueObjects/**
  - `PriceHistoryPoint`, `ConfidenceLevel`, `CronSchedule`, `BotStatus`.
- **Exceptions/**
  - `InvalidTickerException`, `PortfolioLimitExceededException`.

–ù–∏–∫–∞–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –¢–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å –∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ.

---

## üìÅ `BlackCandle.Telegram` ‚Äî Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –±–æ—Ç, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **Services/**
  - `TelegramNotifier` ‚Äì –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.
  - `TelegramCommandHandler` ‚Äì (–æ–ø—Ü.) –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ —Ç–∏–ø–∞ /status, /report.
- **Models/**
  - `TelegramMessage`, `TelegramUser`, `TelegramSettings`.
- **Interfaces/**
  - `ITelegramService` ‚Äì –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ Application.

---

## üìÅ `BlackCandle.Scheduler` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –∫—Ä—É—Ç–∏—Ç—å cron-–∑–∞–¥–∞–Ω–∏—è, –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω, —É–º–µ—Ç—å –æ—Ç—Ä—É–±–∞—Ç—å—Å—è.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **Jobs/**
  - `PortfolioAnalysisJob` ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞.
  - `RetryFailedJob` ‚Äì (–æ–ø—Ü.) –ø–æ–≤—Ç–æ—Ä –Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ API.
- **Scheduler/**
  - `HangfireScheduler`, `QuartzScheduler` ‚Äì —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `ISchedulerAdapter`.
  - `ScheduleConfiguration` ‚Äì —Å—á–∏—Ç—ã–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
- **Utils/**
  - `JobContextLogger` ‚Äì –ø–∏—Å–∞—Ç—å —à–∞–≥–∏ –≤ –ª–æ–≥.

---

## üìÅ `BlackCandle.Tests` ‚Äî —é–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

üëâ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ –∞–¥–∞ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

### –°–æ–¥–µ—Ä–∂–∏—Ç:

- **Application/**
  - `AnalysisServiceTests`, `PortfolioServiceTests`, `SignalServiceTests`.
- **Infrastructure/**
  - `TinkoffClientTests`, `MoexClientTests`, `SkenderWrapperTests`.
- **Telegram/**
  - `TelegramNotifierTests`.
- **Mocking/**
  - `FakeTinkoffClient`, `MockSupabaseStorage`.
- **Fixtures/**
  - –ó–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—Ñ–µ–ª–∏, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏ —Å–∏–≥–Ω–∞–ª—ã.

---

## üîÅ **–ü–∞–π–ø–ª–∞–π–Ω –±–æ—Ç–∞ (RunPortfolioAnalysisUseCase)**  
üìÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏–±–æ:  
‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (—á–µ—Ä–µ–∑ `SchedulerAdapter`)  
‚Äî –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API (`AnalysisController.TriggerNow()`)

---

## üî∑ –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è
### –ö–ª–∞—Å—Å: `PortfolioService.GetCurrentPortfolio()`
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–∏–∫–µ—Ä—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏).
- –í–∞—Ä–∏–∞–Ω—Ç: –∏–∑ Supabase, –ª–∏–±–æ –ª–æ–∫–∞–ª—å–Ω–æ.
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–∞, –∏–Ω–∞—á–µ –±—Ä–æ—Å–∞–µ—Ç `EmptyPortfolioException`.

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `IDataStorage` (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî `SupabaseStorage`)

---

## üî∑ –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–∫–µ—Ä—É
### –ö–ª–∞—Å—Å: `MarketDataAggregator.FetchHistoricalData(IEnumerable<Ticker>)`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `TinkoffClient` –∏/–∏–ª–∏ `MoexClient` (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏—Ä–∂–∏).
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç OHLCV –¥–∞–Ω–Ω—ã–µ (Open, High, Low, Close, Volume) –∑–∞ –∑–∞–¥–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –≥–æ–¥).
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ `List<PriceHistoryPoint>`

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
> - `ITinkoffClient`
> - `IMoexClient`

---

## üî∑ –®–∞–≥ 3: –†–∞—Å—á—ë—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
### –ö–ª–∞—Å—Å: `IndicatorService.CalculateIndicators()`
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `List<PriceHistoryPoint>` –Ω–∞ –≤—Ö–æ–¥.
- –í—ã–∑—ã–≤–∞–µ—Ç `SkenderWrapper` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞:
  - `SMA`, `EMA`, `RSI`, `MACD`, `ADX`, –∏ —Ç. –¥.
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `List<IndicatorResult>` –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∏–∫–µ—Ä—É.

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `ISkenderIndicatorEngine`

---

## üî∑ –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
### –ö–ª–∞—Å—Å: `SignalService.GenerateSignals(indicators, portfolio)`
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏ —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ.
- –í—ã–¥–∞—ë—Ç —Å–∏–≥–Ω–∞–ª—ã —Ç–∏–ø–∞:
  - `Buy`, –µ—Å–ª–∏ RSI < 30 –∏ —Ü–µ–Ω–∞ –ø—Ä–æ–±–∏–ª–∞ EMA
  - `Sell`, –µ—Å–ª–∏ RSI > 70 –∏ MACD —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è
  - `Hold` ‚Äî –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `List<TradeSignal>`

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `ISignalPolicyEngine` (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å –æ—Ç–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é)

---

## üî∑ –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
### –ö–ª–∞—Å—Å: `AnalysisResultRepository.SaveAnalysisResult()`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `PortfolioAnalysisResult` –∏ `TradeSignals` –≤ –±–∞–∑—É.
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö –∏ —Ñ—Ä–æ–Ω—Ç–µ.

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `IDataStorage`  

---

## üî∑ –®–∞–≥ 6: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
### –ö–ª–∞—Å—Å: `TelegramService.SendAnalysisSummary(signals)`
- –§–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç: –∫–∞–∫–∏–µ —Ç–∏–∫–µ—Ä—ã –ø–æ–∫—É–ø–∞—Ç—å, –ø—Ä–æ–¥–∞–≤–∞—Ç—å, –¥–µ—Ä–∂–∞—Ç—å.
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ `TelegramNotifier`.

–ü—Ä–∏–º–µ—Ä:
```
üìà –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª:
- üî¥ –ü—Ä–æ–¥–∞—Ç—å: GAZP (RSI=79, MACD ‚¨á)
- üü¢ –ö—É–ø–∏—Ç—å: YNDX (RSI=22, EMA –ø—Ä–æ–±–∏—Ç)
- üü° –î–µ—Ä–∂–∞—Ç—å: SBER
```

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `ITelegramService`

---

## üî∑ –®–∞–≥ 7: –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞
### –ö–ª–∞—Å—Å: `LoggerService.LogStep()`
- –í –∫–∞–∂–¥—ã–π –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç (–¥–æ/–ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞) –ø–∏—à–µ—Ç –ª–æ–≥:
  - `StartAnalysis`
  - `FetchedData`
  - `CalculatedIndicators`
  - `GeneratedSignals`
  - `SentToTelegram`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤ Logtail/–±–∞–∑—É (–ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).

> üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `ILoggerService`

---

## üîÅ –ö–∞–∫ –≤—Å—ë —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è: `RunPortfolioAnalysisUseCase`

```plaintext
Scheduler ‚Üí RunPortfolioAnalysisUseCase
           |
           ‚îú‚îÄ PortfolioService.GetCurrentPortfolio()
           ‚îú‚îÄ MarketDataAggregator.FetchHistoricalData()
           ‚îú‚îÄ IndicatorService.CalculateIndicators()
           ‚îú‚îÄ SignalService.GenerateSignals()
           ‚îú‚îÄ AnalysisResultRepository.SaveAnalysisResult()
           ‚îú‚îÄ TelegramService.SendAnalysisSummary()
           ‚îî‚îÄ LoggerService.LogStep()
```

---

## üîí –í–æ–∑–º–æ–∂–Ω—ã–µ ‚Äú—Å—Ç–æ–ø-–∫—Ä–∞–Ω—ã‚Äù

- **–ö–ª—é—á–µ–π –Ω–µ—Ç** ‚Üí `MissingApiKeyException` (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ª–æ–≥).
- **MOEX –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç** ‚Üí Retry + –ª–æ–≥.
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–ª–∏—Å—å** ‚Üí `IndicatorCalculationException`
- **–ü—É—Å—Ç–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å** ‚Üí skip –∞–Ω–∞–ª–∏–∑–∞.

---

## ‚è≤Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–º (BlackCandle.Scheduler)

- **QuartzScheduler / HangfireScheduler**
  - –†–µ–≥–∞–µ—Ç `PortfolioAnalysisJob`
  - –ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç `CronSchedule` –∏–∑ –ë–î/–∫–æ–Ω—Ñ–∏–≥–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç:
  - –í–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –±–æ—Ç–∞ (—Ñ–ª–∞–≥ `BotStatus`)
  - –ú–µ–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–ø—É—Å–∫–∞
  - –§–æ—Ä—Å–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

---
